<?xml version="1.0" encoding="UTF-8"?>
<screen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/xml-screen-2.1.xsd"
        default-menu-title="Edit Version"
        default-menu-include="false">

    <parameter name="appId" required="true"/>
    <parameter name="versionId" required="true"/>

    <transition name="findVersion">
        <default-response url="../FindAppVersion"/>
    </transition>
    <transition name="updateVersion">
        <service-call name="update#commons.server.AppVersion" in-map="context">
            <field-map field-name="updateUserId" from="ec.user.userId"/>
        </service-call>
        <default-response url="."/>
    </transition>
    <transition name="findLocalization">
        <default-response url="../../../Localization/FindLocalization"/>
    </transition>

    <actions>
        <entity-find-one entity-name="commons.server.AppVersionDetail" value-field="version"/>
    </actions>

    <widgets>
        <section name="UpdateVersionSection" condition="version">
            <widgets>
                <container-panel>
                    <panel-header>
                        <link url="findVersion" text="Find Version" icon="glyphicon glyphicon-search"/>
                    </panel-header>
                    <panel-center>
                        <form-single name="UpdateVersionForm" transition="updateVersion" map="version">
                            <auto-fields-entity entity-name="commons.server.AppVersion" field-type="edit">
                                <exclude field-name="inputUserId"/>
                                <exclude field-name="updateUserId"/>
                            </auto-fields-entity>
                            <field name="appId">
                                <default-field>
                                    <hidden/>
                                </default-field>
                            </field>
                            <field name="versionId">
                                <default-field title="ID">
                                    <display/>
                                </default-field>
                            </field>
                            <field name="releaseNotes">
                                <default-field>
                                    <text-area rows="4" cols="80"/>
                                    <link url="findLocalization" target-window="_blank" tooltip="Localizations" icon="glyphicon glyphicon-globe" link-type="anchor" parameter-map="[entityName:'commons.server.AppVersion', fieldName:'releaseNotes', pkValue:versionId, fieldType: 'TEXTAREA']"/>
                                </default-field>
                            </field>
                            <field name="alertTypeEnumId">
                                <default-field title="Alert Type">
                                    <drop-down>
                                        <entity-options text="${description}" key="${enumId}">
                                            <entity-find entity-name="moqui.basic.Enumeration">
                                                <econdition field-name="enumTypeId" value="VersionAlertType"/>
                                                <order-by field-name="sequenceNum,description"/>
                                            </entity-find>
                                        </entity-options>
                                    </drop-down>
                                </default-field>
                            </field>
                            <field name="breaking">
                                <default-field>
                                    <drop-down>
                                        <option key="N" text="No"/>
                                        <option key="Y" text="Yes"/>
                                    </drop-down>
                                </default-field>
                            </field>
                            <field name="creationDate">
                                <default-field>
                                    <display/>
                                </default-field>
                            </field>
                            <field name="submitBtn">
                                <default-field title="Save">
                                    <submit/>
                                </default-field>
                            </field>

                            <field-layout>
                                <fields-not-referenced/>
                            </field-layout>
                        </form-single>
                    </panel-center>
                </container-panel>
            </widgets>
            <fail-widgets>
                <container style="alert alert-warning">
                    <label text="Version with ID [${versionId}] was not found."/>
                </container>
            </fail-widgets>
        </section>
    </widgets>
</screen>