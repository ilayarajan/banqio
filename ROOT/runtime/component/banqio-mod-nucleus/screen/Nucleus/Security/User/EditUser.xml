<?xml version="1.0" encoding="UTF-8"?>
<screen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/xml-screen-2.1.xsd"
        default-menu-title="Profile"
        default-menu-index="1">

    <parameter name="userId" required="true"/>

    <transition name="findUser">
        <default-response url="../FindUser"/>
    </transition>
    <transition name="updateUser">
        <service-call name="banqio.security.SecurityServices.update#User" in-map="context"/>
        <default-response url="."/>
    </transition>
    <transition name="approveUser">
        <service-call name="banqio.security.SecurityServices.approve#User">
            <field-map field-name="userId" from="userId"/>
            <field-map field-name="disabled" value="N"/>
        </service-call>
        <default-response url="."/>
    </transition>
    <transition name="enableUser">
        <service-call name="update#moqui.security.UserAccount">
            <field-map field-name="userId" from="userId"/>
            <field-map field-name="disabled" value="N"/>
        </service-call>
        <default-response url="."/>
    </transition>
    <transition name="disableUser">
        <service-call name="update#moqui.security.UserAccount">
            <field-map field-name="userId" from="userId"/>
            <field-map field-name="disabled" value="Y"/>
        </service-call>
        <default-response url="."/>
    </transition>

    <actions>
        <entity-find-one entity-name="moqui.security.UserAccount" value-field="user">
            <field-map field-name="userId" from="userId"/>
        </entity-find-one>
    </actions>

    <widgets>
        <section name="UpdateUserSection" condition="user">
            <widgets>
                <container-panel>
                    <panel-header>
                        <link url="findUser" text="Find User" icon="glyphicon glyphicon-search"/>
                        <section name="UpdateUserStatus">
                            <condition>
                                <compare field="user.disabled" value="Y"/>
                            </condition>
                            <widgets>
                                <link url="enableUser" text="Enable" icon="glyphicon glyphicon-check" style="btn-success"/>
                            </widgets>
                            <fail-widgets>
                                <link url="disableUser" text="Disable" icon="glyphicon glyphicon-unchecked" style="btn-danger"/>
                            </fail-widgets>
                        </section>
                        <section name="UpdateUserApproval">
                            <condition>
                                <compare field="user.approved" value="N"/>
                            </condition>
                            <widgets>
                                <link url="approveUser" text="Approve" icon="glyphicon glyphicon-check" style="btn-success"/>
                            </widgets>
                        </section>
                    </panel-header>
                    <panel-center>
                        <form-single name="UpdateUserForm" transition="updateUser" map="user">
                            <field name="userId">
                                <default-field title="ID">
                                    <display/>
                                </default-field>
                            </field>
                            <field name="partyId">
                                <default-field>
                                    <display/>
                                </default-field>
                            </field>
                            <field name="username">
                                <default-field>
                                    <display/>
                                </default-field>
                            </field>
                            <field name="fullName">
                                <default-field>
                                    <text-line size="60" default-value="${user.userFullName}"/>
                                </default-field>
                            </field>
                            <field name="externalUserId">
                                <default-field>
                                    <text-line size="40"/>
                                </default-field>
                            </field>
                            <field name="disabled">
                                <default-field>
                                    <drop-down>
                                        <option key="N" text="No"/>
                                        <option key="Y" text="Yes"/>
                                    </drop-down>
                                </default-field>
                            </field>
                            <field name="approved">
                                <default-field>
                                    <display/>
                                </default-field>
                            </field>
                            <field name="approvedBy">
                                <default-field>
                                    <display/>
                                </default-field>
                            </field>
                            <field name="approvalDate">
                                <default-field>
                                    <display/>
                                </default-field>
                            </field>
                            <field name="creationDate">
                                <default-field>
                                    <display/>
                                </default-field>
                            </field>
                            <field name="submitBtn">
                                <default-field title="Save">
                                    <submit/>
                                </default-field>
                            </field>

                            <field-layout>
                                <fields-not-referenced/>
                            </field-layout>
                        </form-single>
                    </panel-center>
                </container-panel>
            </widgets>
            <fail-widgets>
                <container style="alert alert-warning">
                    <label text="User with ID [${userId}] was not found."/>
                </container>
            </fail-widgets>
        </section>
    </widgets>
</screen>